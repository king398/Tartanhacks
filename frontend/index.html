<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fast Food Line Estimation</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Sora:wght@500;600;700&display=swap");

    :root {
      --bg: #f7f8fa;
      --text-main: #212529;
      --text-muted: #73777f;
      --card-bg: rgba(255, 255, 255, 0.88);
      --card-border: rgba(33, 37, 41, 0.08);
      --shadow: 0 14px 30px rgba(24, 36, 52, 0.08);
      --sky-nebula: linear-gradient(120deg, #44c8c8, #9673ff);
      --sunset-glow: linear-gradient(120deg, #ff6f61, #ff9661);
      --success: #42c98d;
      --warn: #ffc75f;
      --error: #ff5a5f;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "DM Sans", "Segoe UI", sans-serif;
      color: var(--text-main);
      background: var(--bg);
      overflow-x: hidden;
      position: relative;
    }

    body::before,
    body::after {
      content: "";
      position: fixed;
      width: 34vw;
      height: 34vw;
      border-radius: 50%;
      z-index: -1;
      filter: blur(36px);
      opacity: 0.35;
      animation: drift 16s ease-in-out infinite;
    }

    body::before {
      background: radial-gradient(circle at center, rgba(68, 200, 200, 0.9), rgba(150, 115, 255, 0));
      top: -10vw;
      left: -8vw;
    }

    body::after {
      background: radial-gradient(circle at center, rgba(255, 111, 97, 0.8), rgba(255, 150, 97, 0));
      right: -10vw;
      bottom: -12vw;
      animation-delay: 3s;
    }

    .layout {
      width: min(1220px, 100% - 32px);
      margin: 24px auto 30px;
      display: grid;
      gap: 16px;
    }

    .panel {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }

    .hero {
      padding: 20px 22px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      animation: fade-up 500ms ease;
    }

    .hero-left {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .kicker {
      width: fit-content;
      font: 700 0.72rem/1 "Sora", sans-serif;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      padding: 8px 11px;
      border-radius: 999px;
      color: #fff;
      background: var(--sky-nebula);
      box-shadow: 0 8px 18px rgba(86, 141, 220, 0.28);
    }

    .title {
      margin: 0;
      font-family: "Sora", "DM Sans", sans-serif;
      font-size: clamp(1.28rem, 2.8vw, 1.85rem);
      letter-spacing: 0.01em;
    }

    .subtitle {
      margin: 0;
      font-size: 0.95rem;
      color: var(--text-muted);
    }

    .status {
      text-align: right;
      font-size: 0.92rem;
      color: var(--text-muted);
    }

    .status strong {
      color: var(--text-main);
      font-family: "Sora", sans-serif;
      font-weight: 600;
    }

    .dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      margin-right: 6px;
      border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 0 0 rgba(66, 201, 141, 0.6);
      animation: pulse 1.6s infinite;
      vertical-align: middle;
    }

    .stream {
      margin: 0 16px 16px;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--card-border);
      background: #0b1218;
      transition: transform 220ms ease, box-shadow 220ms ease;
      animation: fade-up 560ms ease;
    }

    .stream:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 28px rgba(10, 20, 36, 0.18);
    }

    .stream img {
      width: 100%;
      display: block;
      aspect-ratio: 16 / 9;
      object-fit: cover;
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 12px;
      padding: 0 16px 16px;
      animation: fade-up 620ms ease;
    }

    .metric {
      border: 1px solid var(--card-border);
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.84);
      padding: 14px;
      transition: transform 180ms ease, box-shadow 180ms ease, border-color 180ms ease;
    }

    .metric:hover {
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 10px 24px rgba(22, 30, 45, 0.12);
      border-color: rgba(68, 200, 200, 0.34);
    }

    .metric-label {
      margin: 0 0 7px;
      font-size: 0.78rem;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      text-transform: uppercase;
      font-weight: 700;
    }

    .metric-value {
      margin: 0;
      font-family: "Sora", sans-serif;
      font-size: 1.48rem;
      font-weight: 600;
      color: var(--text-main);
    }

    .metric-value.teal {
      color: #2d7f9e;
    }

    .metric-value.green {
      color: #2b9f72;
    }

    .metric-value.warn {
      color: #c07b20;
    }

    .metric-value.gradient {
      background: var(--sunset-glow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(66, 201, 141, 0.55); }
      70% { box-shadow: 0 0 0 9px rgba(66, 201, 141, 0); }
      100% { box-shadow: 0 0 0 0 rgba(66, 201, 141, 0); }
    }

    @keyframes drift {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(12px, 8px); }
    }

    @keyframes fade-up {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 820px) {
      .layout {
        width: min(1220px, 100% - 20px);
        margin-top: 14px;
      }

      .hero {
        flex-direction: column;
        align-items: flex-start;
      }

      .status {
        text-align: left;
      }
    }
  </style>
</head>
<body>
  <main class="layout">
    <section class="panel">
      <header class="hero">
        <div class="hero-left">
          <span class="kicker">Neo-Minimal Gradient</span>
          <h1 class="title">Fast Food Queue Estimation</h1>
          <p class="subtitle">Live tracking dashboard for drive-thru and in-store flow.</p>
        </div>
        <div class="status">
          <div><span class="dot"></span><strong>Live Stream</strong></div>
          <div id="timestamp">Waiting for stream...</div>
        </div>
      </header>

      <section class="stream">
        <img src="/video/feed" alt="Live queue stream" />
      </section>

      <section class="metrics">
        <article class="metric">
          <p class="metric-label">Drive-Thru Cars</p>
          <p class="metric-value teal" id="car_count">0</p>
        </article>
        <article class="metric">
          <p class="metric-label">Estimated Passengers</p>
          <p class="metric-value teal" id="est_passengers">0.0</p>
        </article>
        <article class="metric">
          <p class="metric-label">In-Store People</p>
          <p class="metric-value green" id="person_count">0</p>
        </article>
        <article class="metric">
          <p class="metric-label">Total Customers</p>
          <p class="metric-value" id="total_customers">0.0</p>
        </article>
        <article class="metric">
          <p class="metric-label">Estimated Wait (min)</p>
          <p class="metric-value warn" id="wait_time">0.0</p>
        </article>
        <article class="metric">
          <p class="metric-label">Avg Service Time (sec)</p>
          <p class="metric-value" id="service_time">0.0</p>
        </article>
        <article class="metric">
          <p class="metric-label">Inference Device</p>
          <p class="metric-value" id="inference_device">-</p>
        </article>
        <article class="metric">
          <p class="metric-label">Processing FPS</p>
          <p class="metric-value gradient" id="processing_fps">0.0</p>
        </article>
      </section>
    </section>
  </main>

  <script>
    const ids = {
      timestamp: document.getElementById("timestamp"),
      carCount: document.getElementById("car_count"),
      estPassengers: document.getElementById("est_passengers"),
      personCount: document.getElementById("person_count"),
      totalCustomers: document.getElementById("total_customers"),
      waitTime: document.getElementById("wait_time"),
      serviceTime: document.getElementById("service_time"),
      inferenceDevice: document.getElementById("inference_device"),
      processingFps: document.getElementById("processing_fps"),
    };

    async function refreshMetrics() {
      try {
        const response = await fetch("/api/metrics", { cache: "no-store" });
        if (!response.ok) {
          throw new Error("Unable to load metrics.");
        }
        const data = await response.json();
        ids.timestamp.textContent = `Updated: ${new Date(data.timestamp).toLocaleString()}`;
        ids.carCount.textContent = data.drive_thru.car_count;
        ids.estPassengers.textContent = data.drive_thru.est_passengers.toFixed(1);
        ids.personCount.textContent = data.in_store.person_count;
        ids.totalCustomers.textContent = data.aggregates.total_customers.toFixed(1);
        ids.waitTime.textContent = data.aggregates.estimated_wait_time_min.toFixed(1);
        ids.serviceTime.textContent = data.aggregates.avg_service_time_sec.toFixed(1);
        ids.inferenceDevice.textContent = data.inference_device || "unknown";
        ids.processingFps.textContent = Number(data.performance?.processing_fps ?? 0).toFixed(1);
      } catch (error) {
        ids.timestamp.textContent = "Metrics unavailable";
      }
    }

    refreshMetrics();
    setInterval(refreshMetrics, 1000);
  </script>
</body>
</html>
